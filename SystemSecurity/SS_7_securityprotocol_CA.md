# SS_7_securityprotocol_CA

ㅋㅋ

TLS의 핸드셰이크가 제일 중요하다.

- 이론상 비밀키 S가 양쪽에 공유됐으면 해쉬함수로 무한에 가까운 긴 키 생성이 가능하다.
- 핸드쉐이크에서 K키를 만들어서 6개로 쪼갠다. 방향에 따라 3개씩 나뉜다.
- 대칭키, 이니셜라이제이션 벡터, HMAC 이렇게 3개이다.
- 여기까지 해서 기밀성과 무결성을 제공한다.
- 기본적으로 부인봉쇄, Non repudation은 제공되지 않는다.

## TLS는 Authentication, 인증은 제공되는가?

- 사실 제공이 안된다고 봐야 한다.
- 인증이라 하면 인터넷 뱅킹 예시를 들 수 있다. 앨리스가 앨리스인지를 인증해야 한다.
- 아이디 패스워드를 넣거나 OneTimePassword를 쓸 수 있다. TLS 베이직 프로토콜에는 없다.
- 인증까지 제공하려면 추가적으로 조치를 해야 한다...

## 다시 또 복습

부인봉쇄가 필요한 경우라면...

- 앨리스가 개인키로 메시지 M을 서명하면 부인봉쇄 가능하다.
- 앨리스와 밥 모두 공개키, 개인키 쌍을 가진다. Ka+,Ka-,Kb+,Kb-
  - 각 공개키는 상위 기관 CA로부터 인증서 받았다고 가정



여기에 인증까지 해보자면...

- K키까지 생성됐다. 6개의 키로 쪼개지는
- 인증은 사실 제일 처음 단계에서 한다.


- Challenge response 방법이라고 하면 앨리스가 인증을 해보자
- 밥이 챌린지 리스펀스 방식으로 R이라는 랜덤 넘버를 생성해 내려준다. 



앨리스가 어떻게 자신을 인증할 수 있을까?

- 앨리스와 자신만 알고 있는 정보를 가지고 있는지 확인, 또 앨리스 말고는 그 정보 가진 사람이 없는 경우...
- 앨리스의 개인키를 쓰면 되겠군. R을 앨리스의 개인키 Ka-로 서명을 한다. Ka-(R)
- 앨리스 공개키는 공개된걸로...가정
- 밥이 앨리스의 공개키로 앨리스가 보낸 서명을 풀자 R이 정상적으로 나온 것을 확인
  - 챌린지 리스펀스 방식 구현. 인증 성공

![Collections, Xi Zhang](C:/Users/dkxl1/Downloads/가로사진/Collections, Xi Zhang.jpg)



## 개인키가 털렸다면?

위의 과정에서 내 개인키로 서명을 한 건 맞는데 해커한테 털렸다.

- 그런데 개인키만 훔쳐간다고 해커가 바로 쓸 수 있는 거 아니다.
- 개인키라는 건 너무 중요하기 때문에 저장될 때 절대 플레인 텍스트, 키 값 그대로 저장되지 않는다.
- 대칭키 K를 가지고 개인키를 저장한다. K(Ka-)

결국 해커가 쓰려면 개인키 저장할 때 사용했던 대칭키를 알아야 한다.

해커가 쓸 수 있는 방법이 2개 정도 있는데 노트북 해킹해서 앨리스가 인터넷 뱅킹 로그인할 때 ..덤프 떠서 가져가던가 앨리스 노트북에 키 로고를 설치해서 키보드 친 거를 다 저장해서 찾아내는...

---

앨리스가 자신의 개인키가 털린 것 같다면 제일 먼저 CA에 연락한다.

CA에서 뭘 해주나

- CA에도 Kc+, Kc-가 있어 앨리스의 공개키에 대해 Kc-(Ka+) 이게 서명이다. 공인인증서
- CA는 해킹당했다고 하면 발급했던 공인인증서를 더 이상 쓰지말라고 표시한다.
- 이렇게 해킹당했다고 CA에게 신청하는 사람들을 **CRL**이라고 한다. 동영상에 나왔대..ㅎㄹ

## 키스토어

정리하면 이제 내 개인키가 해킹되거나 외부에 유출되면 진짜 큰일이다.

그렇다면 개인키를 굉장히 안전하게 저장해야겠다.

시스템에서 안전한 위치를 키스토어라고 한다.

## 트러스트 스토어

만료된 인증서도 나는 믿겠다라고 거기의 공개 키를 받는다. 그리고 트러스트 스토어에 넣어두는데

트러스트 스토어 안의 공개 키는 내가 믿는다.

- 밥의 공개키를 믿어서 트러스트 스토어에 등록했다.
  - 밥이 해당 공개키에 대응되는 개인키로 서명했을 때 나는 무조건 믿겠다.

![🎐](C:/Users/dkxl1/Downloads/가로사진/🎐.jpg)

여기까지 TLS 끝....

CA시작...



## Certificate Authority - CA

CA는 디지털 인증서를 발급하는 기관으로 공개 키의 소유자에 대한 정보를 포함하는 디지털 인증서를 발급한다. 상대방의 공개 키를 신뢰할 수 있게 한다.

CA가 자신의 개인키로 PKI에 참여하는 일반 사람들의 공개키를 서명해준다.

## PKI

공개 키 기반 인프라. 네트워크 상에서 공개키와 개인키를 사용해 보안을 하는 구조이다.

## CA의 필요성

생판 모르는 남의 공개키를 어떻게 믿을 것인가.

최초의 누군가는 서로 신뢰해야 한다. 

그 역할이 PKI 구조(공격형 암호화 알고리즘)에서는 CA(Certificate Authority)가 한다.

---

CA도 개인키 공개키가 존재한다.

- CA의 개인키로 남들의 공개키를 서명한다.
- RA는 옛날 개념인데 직접 대면해서 본인 확인하는 그런 기관



## X.500

디렉토리 서비스, 즉 어떤 사람이나 물건들에 대한 내용을 디렉토리에 등록한다.

모든 사람 물건에 고유 아이디를 부여하겠다는 아이디어

X.509는 모든 객체의 식별된 아이디끼리 메시지를 주고받을 때 보안에 대한 개념을 공개 키처럼 만든 것이다.



