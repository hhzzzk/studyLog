# SS_9_1_networksecurity1(기말시작)

[TOC]



![image](https://github.com/hhzzzk/studyLog/assets/67236054/ecb6f9b1-0b2d-4906-9914-9516cba2f7ae)

```
PS C:\Users\user> ping www.kookmin.ac.kr
ping www.kookmin.ac.kr [113.198.215.98] 32바이트 데이터 사용:
113.198.215.98의 응답: 바이트=32 시간=13ms TTL=56
113.198.215.98의 응답: 바이트=32 시간=2ms TTL=56
113.198.215.98의 응답 : 바이트=32 시간=6ms TTL=56
113.198.215.98의 응답 : 바이트=32 시간=9ms TTL=56

113.198.215.98에 대한 Ping 통계:
패킷: 보냄 = 4, 받음 = 4, 손실 = 0 (0% 손실),
왕복 시간(밀리초):
최소 = 2ms, 최대 = 13ms, 평균= 7ms
```



국민대 사이트로 PING = ICMP 에코 요청을 보내게 된다.

- 113.198, 어쩌구는 호스트 이름인 국민대 사이트를 IP 주소로 변환한 것이다.
- 32바이트 데이터 사용은 각 ICMP 패킷이 32바이트의 데이터를 포함한다.
- 그 아래 4줄은 ICMP 에코 요청에 대한 응답이다. 4개의 패킷을 보내고 받았다.



## 프로토콜과 보안

TCP, UDP, ICMP 등의 네트워크 통신을 위한 프토토콜이 존재한다.

TCP와 UDP는 데이터 전송에 있어서 상대방에 대한 검증 및 보안을 고려하지 않는다는 점에서 보안의 취약성을 가지고 있다. 

TCP는 초기 연결과정에서 *상대방의 정체성을 검증하지 않기*에 공격자가 IP 스푸핑을 사용해 공격할 수 있다.



이러한 이유는 설계 당시에는 연결 지향성과 신뢰성을 강조하는 프로토콜로 개발되었고

오픈 시스템 환경에서 다양한 환경에서 사용하기 위해 설계되었기 때문이다.

(TLS, SSL 등으 사용해 보안을 확보할 수 있다.)



## 공인 IP와 사설 IP

공인 IP 주소는 인터넷 상에 공개된 식별되는 주소이다. 우리가 사용하는 링크 대부분이다.



사설 IP는 개인이 사용한다. 10~, 192~, 172~ 등이 대표적이다.

10은 클래스 A, 172는 클래스 B, 192는 클래스 C

## C클래스 IP 주소

192.0.0.0에서 223.0.0.0이며, 일반적으로 24비트의 서브넷 마스크를 사용해 네트워크를 나눈다.

C 클래스 IP 주소에서 24비트를 네트워크 식별자로 사용하고, 나머지 8비트를 호스트 주소로 사용

8비트 호스트 주소를 2^8, 즉 256개의 서로 다른 호스트 주소를 사용할 수 있다.

- **네트워크 식별자** : 192.168.1.0/24 서브넷에서 첫 번째 주소인 192.168.1.0은 네트워크 식별자
- **브로드캐스트 주소** : 192.168.1.0/24 서브넷에서 마지막 주소인 192.168.1.255는 브로드캐스트 주소로 예약



따라서 실제로 할당 가능한 IP 주소 수는 256개 중에서 네트워크 식별자와 브로드캐스트 주소를 제외한 2개를 빼면 254개입니다. 이 254개의 IP 주소가 호스트에 할당 가능한 주소로 사용

대충 넘어가



## Smurf attack

- 스머프 공격은 대량의 ICMP(인터넷 컨트롤 메시지 프로토콜) 에코 응답 메시지를 피해자에게 보내는 공격 유형이다.
- 이런 메시지의 집합은 피해자의 정상적인 작동을 중단시키는 공격. Dos, denial of sefvice 서비스 거부의 한 형태이다.



스머트 공격은 일반적으로 공격자가 여러 컴퓨터나 기기를 이용해 피해자에게 ICMP 에코 요청 메시지를 대량으로 보낸다. 이러한 ICMP 에코 요청은 보통 다른 기기로부터 오는 합법적인 요청이다.

따라서 공격자가 대량으로 이러한 요청을 보내면 피해자는 수많은 ICMP 에코 응답을 생성하게 되고 이로 인해 피해자의 네트워크나 서버가 과부하되어 정상적인 작동을 멈춘다.

---

---



라우터에 연결된 하나의 서브넷에서 3번 노트북이 서버인 5번을 확인하기 위해 핑을 보낼 수 있다.

- 만약 C클래스 서브넷=255개의 IP 가능, 에서 관리자가 *다른 모든 노드의 확인*을 하고 싶으면 다른 모든 노드에게 핑을 보내고 살아있는 노드는 응답하는 방식으로 현재 살아있는 노드를 확인할 수 있다.
- 이게 서브넷 스캐닝 = 네트워크 스캐닝 : **서브넷 내의 모든 호스트 또는 노드에 핑 보내서 살아있는 노드 확인**하는 방법
  - 이를 위해 서브넷에 전부 PING을 보내는 명령어가 존재한다. (255개 하나씩 하는거 에바자나 그래서)
  - 그러나 이런 **명령어를 악용**할 수 있다.

만약 해커가 8번 IP에 장애를 발생시키려고 하면

1. 공격자가 서브넷 스캐닝 보낸다.
2. 그런데 출발지 IP 주소를 8번으로 IP 스푸핑(RAW 소켓 이용)해서 보낸다.
3. 그렇다면 핑=리퀘스트의 응답=리플라이가 8번으로 몰리게 된다.
4. 이런 게 DDos 공격이다. 8번 주소가 죽게 될 것이다. = 서비스 중단



소켓 프로그래밍에서 출발지 ip 주소나 포트번호는 디폴트 값으로 사용되고 따로 지정하지 않는다. 즉 지정할 수 없었다. 그러나 TCP/UDP는 오픈 시스템이기 때문에 여러 옵션이 존재하는데 그 중 하나가 RAW 소켓이다.

## RAW 소켓

RAW 소켓을 사용해 출발지 IP 주소를 수정할 수 있다. 이를 해커들이 악용한다!

TCP/UDP가 오픈 시스템 지향이기 때문에 발생한 문제다.



## 스머프 공격 시나리오

1. 공격자는 피해자의 IP 주소를 소스 IP 주소, 출발지 IP 주소로 한다.
2. 브로드캐스트 주소를 대상 IP 주소로 하는 ICMP 에코 요청=PING 패킷을 보낸다.
3. 이 때 IP 스푸핑(IP 주소 변조) 기술을 사용해 패킷의 출발지 IP 주소를 피해자의 주소로 위장한다.
4. ICMP 에코 요청 패킷을 수신한 네트워크의 모든 호스트들은 ICMP 에코 응답 메시지를 생성해 피해자의 IP 주소로 보낸다.
5. 피해자는 수많은 ICMP 에코 응답 메시지를 받게 되며, 이로 인해 너무 많은 패킷을 처리해야 하므로 정상적인 서비스를 할 수 없게 된다.



## 스머프 공격 대책

1. 개별 호스트와 라우터를 핑 요청이나 브로드캐스트에 응답하지 않도록 한다.

   - 핑이나 브로드캐스트처럼 네트워크 주소에 대한 부분은 응답하지 않도록 한다.


   - •In Linux, echo "1" > /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts
     - 해당 명령은 ICMP 에코 요청 패킷이 브로드캐스트 주소로 전송될 때 호스트가 응답하지 않도록 한다.

2. 라우터를 구성해 브로드캐스트 주소로 전송된 패킷을 전달하지 않도록 한다.



## Packet Sniffing

> 패킷 스니핑은 데이터 패킷을 가로채서 엿보는 것이다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/e799c571-4489-461e-9199-6f2d5c5e33de)

네트워크 탭 장비다. 네트워크 물리 계층 1계층에서 작동하는 하드웨어 장치로 네트워크 트래픽을 모니터링하고 분석하기 위해 사용된다.



## 허브와 스위치

초기 TCP,UDP는 스위치가 아니라 허브를 통해 통신했다.

허브가 스위치로 발전했다.

허브와 스위치의 차이 중요

**허브** : OSI 모델에서 물리계층, 레이어1에서 동작한다.

- 허브는 데이터를 전기적 신호로 변환해 네트워크에 연결된 모든 장치로 브로드캐스트한다.
  - 따라서 모든 장치가 전송된 데이터를 수신한다.
- 허브는 성능이 안좋기에 다른 지능적인 역할 수행을 못한다. 단순히 전기신호를 복사하는 기능만 가능했다.
  - 그래서 신호가 겹칠 경우 충돌, **collision이 발생**해 두 시노 모두 사라지는 문제가 발생한다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/47ebb88c-50e4-43df-a1a2-75ea4dbeb2ef)



**스위치** : OSI 모델에서 데이터 링크 계층, 레이어 2에서 동작한다.

- 스위치는 데이터를 분석해 목적지 MAC 주소를 확인해 정확한 포트로 전송할 수 있다. 지능적 역할 수행
  - 허브처럼 모두 전송하는 불필요한 작업을 줄였다. 필요한 장치로만 데이터 전달! 트래픽 효율적 관리
- 네트워크 상의 각 장치의 MAC 주소를 기록하고 데이터를 스위칭해 정확한 장치로 전송한다.
- 링크레이어의 혁명인데 동시에 여러 신호를 처리할 수 있고 병렬처리가 가능하다!



## MAC flooding attack = 스위치의 약점 공격

*보안의 시점*

해커가 봤을 때는 허브를 이용하면 남의 패킷을 볼 수 있으므로 편리했다.

- 스위치에서도 브로드캐스트 패킷이 존재한다. 바로 ARP 리퀘스트 패킷인데 이를 통해 다른 장치의 MAC 주소를 알아낸다.

그렇다면 어떤 MAC 주소가 스위치 장비의 몇 번 슬럿(포트)에 있는지를 알아야 한다. 

>  그러므로 스위치는 매핑 테이블을 이용해 메모리에 해당 정보를 저장해둔다.



그런데 만약 메모리 상의 한계로 메모리 테이블이 가득찬다면 지워야 한다.

해커는 이를 악용해 메모리를 이상한 값으로 채우고 = 가짜 ARP 리퀘스트 패킷 생성

**강제로 브로드 캐스트를 할 수 밖에 없도록 만든다.!!!!!!**

(브로드 캐스트하면 패킷을 볼 수 있으므로)

옛날 허브 방식처럼 브로드캐스트를 할 수 밖에 없도록 만드는 것

이러한 공격이 MAC flooding attack이다.



---

스위치는 ARP 리퀘스트를 날리면 응답을 할 것이다. 이를 통해 MAC 주소를 얻는다.

링크레이어에서 MAC주소를 넣는다.



허브장비는 패킷을 전기신호로 복제해서 전부 보낸다. 받은 곳에서 목적지 IP 주소가 자신이면 거기서 처리하고 응답한다. 다른 곳에서는 관여하지 않는다.



## MAC flooding attck 대책

스위치는 MAC 주소 테이블을 유지하는데 여기에는 슬롯과 MAC 정보를 저장한다.

**이상탐지**

이상탐지를 통해 IP:MAC 주소의 관계가 너무 많이 바뀌면, 다양성이 감지되면 이상탐지로 감지한다.

- 한 IP 주소에 여러 개의 MAC 주소가 연결되면 이상탐지



**오탐문제, false-positive 공격**

라우터의 mac 주소는 고정되어 있다.

출발지 주소는 바뀐다. 즉 위의 IP:MAC 페어쌍이 키랑 value일 때 이상탐지처럼 다양성이 생길 수 밖에 없다. 라우터는 계속해서 주소들이 드나드는 통로이기 때문에



그래서 이상탐지가 발생한다. 오탐 발생 에러의 예시