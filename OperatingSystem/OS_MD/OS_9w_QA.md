# OS_9w_QA

9W 26,27,28

5/2 화요일

# 35

특권명령은 인터럽트 컨트롤하는 거로 락 언락할때

크리티컬 섹션 코드 조각, 상태를 공유하는 상태를 읽어서 변경, 테스트 앤셋구현

여러 쓰레드, 실행흐름에서 동시에 실행하면 안되는게 크리티컬 섹션 부분

상호배제, 동시실행 안되게, 동기화되게

경쟁조건 생겨서 동시실행하면 안됨



​	__특권명령 사용하면 기다리는동안 cpu 사용하지는 않음__

​	spin은 while 루프 돌기 때문에 wait 하는 동안 cpu 사용함



cpu가 1개냐 2개냐 멀티프로세서 환경인지 여부

cpu 1개 단일프로세서일때 락걸고 크리티컬 섹션 테스트앤셋하다가 테스트만 했는데 인터럽트, 타임아웃걸려서

쓰레드교체됨, 락걸린 상태라 쓰레드는 while루프돌면서 spin 계속함. 언락될때까지 

언락은 언제 되나, a가 언락해야함. a는 현재 타임아웃걸려서 레디상태, 스케줄링되어야함

그럼 a는 b가 타임아웃되어야 a 스케줄링되서 실행가능함



a 마저 셋하고 작업하고 언락, 타임아웃되고 b가 이제 락 건다, acquire

b가 테스트 앤셋하고 작업



상호배제 정상작동함, spin 하면서 대기상태 유지 크리티컬 진입안하고



최악의 경우 타임아웃될때까지 spin도는 경우, 크리티컬 섹션 길이와는 무관



/



cpu2개 이상인 멀티프로세서 환경에서

각자  cpu가 있어서 run 상태 유지 가능 각자



@@@@@spin을 얼마나 도는가를 결정하는 것이

크리티컬 섹션의 길이임. @@@



```
멀티프로세서 환경에서는 스핀을 도는가를 결정하는 것이 크리티컬 섹션의 길이임
단일프로세서 환경에서는 스핀도는것과 크리티컬 섹션의 길이는 무관함(타임아웃언제되는지가 스핀도는정도를 결정함)
```

```
cpu 낭비는 busy waiting, 단순히 기다리면서 cpu 소모하는 것
```



# 36

???숙제예정

힌트는 테스트했는데 다른 쓰레드가 개입해서 

# 37 Concurrency퀴즈 2번 문제

![image](https://user-images.githubusercontent.com/67236054/235597411-c3e363f7-aecf-437c-a7ba-80fcf0f3b4d7.png)

16라인에서 쓰레드 생성, create, 실행과는 무관함

@@@쓰레드 생성과 실행은 구분@@@

실행되려면 스케줄링 되어야함

16하고 t1은 레디상태



쓰레드 생성하면 스택 생성, 이 쓰레드가 무슨일을 할지 함수로 정의 그시작주소 인자로 전달 mythread

함수이름이 시작주소임



스케줄링이 되면 런상태로 바뀌고 함수를 호출함

쓰레드스택에 함수의 액티베이션 레코드 생성되면서 i등 지역변수 들어감



메인도 스택이 있고 함수로 호출하면 액티베이션 레코드 생성되면서 또 생김

![image](https://user-images.githubusercontent.com/67236054/235598397-ec5f3f6e-36c5-4efd-97a2-f125bb66ad97.png)



join 빼도 실행되긴함 조인없어도 문제 생길 확률 굉장히 낮긴함

그러나 조인없으면 경쟁조건이 생기기 때문에 원리상 틀린게 맞음



exit는 해당 프로세서 전체가 끝나는것

조인을 빼면 메인함수가 끝날때 쓰레드1이 시작도못하고, 혹은 실행중에 갑자기 끝날 수 있다







# 38

굶기starvation는 특정 스레드가 자원을 너무 오래동안 가지고 있는 경우, 

# 39

cpu가 run상태라 봤는ㄴ데 wating만 하는중인 경우 cpu 낭비임



#40

중복질문



cpu 1개 인경우 스핀하면 케이스에 따라 성능이 제대로 나오지 않는 경우 존재한다. 

# 41

크리티컬 섹션은 7번 라인 한줄임

join이 빠지면 다른 경쟁조건 발생, 쓰레드1이 비명횡사 가능,,,



락,언락이 없어 경쟁조건이이 있는(7번라인에 )프로그램임

LD, ADD, ST 세개의 명령어가 7번 라인 한줄의 내용인데

세개의 어디서 타임아웃이 걸려서 다른 쓰레드가 크리티컬 섹션에 진입할수 있음

그래서 진입해버린 경우라면 ~ 강의 보셈

결국 다 기대값 미치지 않을것

# 42

맞음 동의함. 그러려니...

교수님의 논리도 이해해야함. 문제의 취지나 의도 생각

