# CV_2w_2_Histogram

# 프리뷰

```
2.2 히스토그램
2.2.1 히스토그램 계산
2.2.2 히스토그램 용도
2.2.3 히스토그램 역투영과 얼굴 검출

2.3 이진영상
2.3.1 이진화와 오츄 알고리즘
2.3.2 연결요소
```

# 🌻히스토그램 계산

>  주어진 영상에서의 명암값의 농도를 막대 그래프로 표현

- [0,L-1] 사이의 명암값 각각이 영상에 몇번 나타나는지 표시

![image](https://github.com/hhzzzk/studyLog/assets/67236054/af5c47c4-8a4d-4871-8888-a3a86d84a90b)

- m*n크기의 명암 영상을 >>> 히스토그램과 정규 히스토그램으로 출력

  ​

## 예제 명암 영상에서 히스토그램 계산

- h(2)=13, 명암값이 2인 화소가 13개임. 정규화하면 13 / M*N



# 🌻히스토그램 용도

- 영상의 특성 파악 > 어두운 영상인지, 어두운 부분 파악
- 🍁히스토그램 평활화 (Equalization)🍁
  - 히스토그램을 평평하게 만드는 연산
  - 명암의 __동적 범위를 확장__(안보였던 부분 잘보이게)해 영상 품질 향상
  - 누적 히스토그램🌺을 매핑함수로 사용
  - 입력 > 정규화 > 누적히스토그램 > 누적*(L-1) > 반올림



+) 히스토그램 평활화

- 명암 분포가 빈약한 영상을 균일하게 만들기
- 영상의 밝기 분포를 재분배해 명암 대비를 최대화하고 명암 대비 조정을 자동으로 수행하게끔, 단 각 명암 빈도는 변경되지 않음
- 영상의 검출 특성 증가
- [참고사이트](https://gaussian37.github.io/vision-concept-histogram_equalization/)



# 🌻히스토그램 역투영과 얼굴 검출

>  히스토그램 역투영 : 히스토그램을 매핑 함수로 사용해 화소 값을 신뢰도 값으로 변환

![image](https://github.com/hhzzzk/studyLog/assets/67236054/78bc70ee-bc1a-4a54-aa11-4f61baa8bdc8)



> 얼굴검출 : 모델 얼굴과 2차원 히스토그램

- 얼굴 검출
  - 모델 얼굴에서 구한 히스토그램 h(m)은 화소의 컬러값을 해당하는 신뢰도 값으로 변환
  - 실제로는 비율 히스토그램 h(r)을 사용
  - ![image](https://github.com/hhzzzk/studyLog/assets/67236054/abc1bfe5-b7d8-45d2-9c28-9868a9b1f9c1)
- 히스토그램 역투영 알고리즘
- ![image](https://github.com/hhzzzk/studyLog/assets/67236054/cd0ad5ab-f5cf-4449-8cbd-f987316ca787)
  - 히스토그램 역투영 결과
    - 얼굴과 손 영역은 높은 신뢰도 값
    - 한계 : 비슷한 색 분포를 가지는 다른 물체 구별 못함. 검출 대상이 여러 색 분포를 가지면 오류 가능성
    - 장점 : 배경을 조정할 수 있는 상황에 적합(이동과 회전에 불변, 가림occlusion에 강인)
    - (가우시안 분포, 가까우면 1 멀면 0)



---

# 💌이진화와 오츄 알고리즘

> 이진화 : 명암 영상을 흑백만 가진 이진 영상으로 변환, 1/0

- 임계값 방법
  - 두 봉우리 사이의 계곡을 임계값 T로 결정
  - 자연 영상에서는 계곡 지점 결정이 어려움 (기준달라)



## 오츄 알고리즘

- __이진화__ 했을 때 흑백 그룹 각각이 균일할수록 좋다는 원리에 근거
- 균일성은 분산으로 측정 (분산 작을수록 균일성 높음)
- 분산의 가중치 합 v(within)을 목적 함수로 이용한 최적화 알고리즘
- ![image](https://github.com/hhzzzk/studyLog/assets/67236054/279c6d09-ed94-4b3d-b320-99b4427753fa)
  - 왼쪽 오른쪽으로 나누어서 평균과 분산 구함. > 분산 작을수록 균일성 크므로 높은 점수. > 균일성 크다는 건 왼쪽 오른쪽 균형이 잘 맞을수록 좋음
  - 가능한 모든 T에 대해 점수 계산 후 가장 좋은 T(가장 균일해지도록 하는)를 최종 임계값으로 취하는 최적화 알고리즘

---

+) [참고사이트](https://hojak99.tistory.com/152)

- T가 오츄 알고리즘의 핵심 식, Vwithin(t)가 목적 함수(최적화 알고리즘에서 점수계산에 사용하는 함수)
- 목적함수는 두 분산의 가중치 합.
- W0(t)와 W1(t)는 임계값 t에 따라 생성된 흑화소와 백화소 집합의 크기로 가중치 역할함

---

- t-1번째 계산 결과를 t번째에 활용해 빠르게 계산
- ![image](https://github.com/hhzzzk/studyLog/assets/67236054/4b23c039-1700-4264-8b4a-16a8f1e542e7)
- ![image](https://github.com/hhzzzk/studyLog/assets/67236054/65f5ced8-ba13-447e-a726-c675405f0c4e)
- ![img](https://blog.kakaocdn.net/dn/TKPUD/btrffOSdKsP/FABLmqSdEJARV6RYUZwnK0/img.png)
- [참고](https://100s.tistory.com/37)



# 💌연결요소

- 화소의 모양과 연결성

---

+) 

- 이진 영상을 살펴보면 서로 연결된 화소의 집합이 여럿 나타난다. 이들 집합 각각을 **연결요소**라 부른다.
- 연결 요소들은 보통 별도로 다루기 때문에, 이들 각각에 고유한 번호를 라벨링 해주어야 한다.

## 화소의 모양과 연결성

- 화소를 표현하는 방법은 여러 가지가 있다.
- 2차원 영상에서 화소를 나타내는 가장 일반적인 방법은 사각형이다. (4연결성 제일 많이 사용)
  - 원은 빈 공간이 생기는 문제가, 육각형은 좌표를 지정하기가 어렵다는 문제가 있기 때문이다.

![img](https://blog.kakaocdn.net/dn/kW8Hy/btrfc7Lvivv/K9SdITdKWd7bknk5Dffl20/img.png)

- 위치에 대해서 4방향, 8방향의 픽셀만 나의 이웃으로 판단하는 것을 각각 4-연결성, 8-연결성이라고 말한다.
- 🔎4-연결성🔎은 계산의 효율성이 좋다. 주변의 4개만 확인하면 되기 때문이다. 하지만 주변에 있음에도 불구하고 연결성을 고려하고 있지 않는 부분도 있기 때문에, 인접해있다고 하더라도 떨어져 있는 덩어리처럼 보일 수 있다.
- 8-연결성은 반대로 계산의 효율성은 떨어진다. 하지만 주변에 인접한 픽셀의 연결성을 모두 고려한다.

## **연결요소 번호 붙이기**

- 4-연결성과 8-연결성

![img](https://blog.kakaocdn.net/dn/qLlac/btrffPcwenq/puVlqPYga9U4QyV1nfvWB1/img.png)

1. 1을 만날 때까지 픽셀을 (0, 0) → (M-1, N-1) 방향으로 이동시킨다.
2. 1을 만나면 1이라는 라벨을 붙여준다. 이후 4-연결성일 때는 해당 픽셀 기준으로 [i-1][j], [i][j-1], [i][j+1], [i+1][j]에 1이 있는지 확인한다.
3. mask image ) 이미 처리된 pixel은 mark를 하고 더 이상 고려하지 않는다.
4. Label의 영역이 끝나면 다시 영상을 처음부터 읽어나간다. 다시 image [i][j] == 1을 만나면 다음 라벨인 2를 붙여나간다.
5. 영상을 다 읽을 때까지 반복한다.

## **범람 채움**

- 위와 같이 연결요소를 찾아 번호를 붙이는 것을 범람 채움이라고 한다.
- 이차원 영상에서 가장자리 픽셀을 기준으로 4-연결성, 8-연결성을 사용하면 픽셀에 없는 곳에서 값을 읽어오려고 하게 된다. → 스택 오버플로우 발생 위험
  - 해결 1) 영상의 가장자리 픽셀을 제외한 안쪽 픽셀만을 탐색한다. 4-연결성이 되었든, 8-연결성이 되었든 밖으로 빠져나갈 일이 없다.
  - 해결 2) 2차원 영상의 테두리에 0으로만 이루어진 픽셀을 둘러준다. → padding

#### **스택 오버플로우 위험**

![img](https://blog.kakaocdn.net/dn/9GAKS/btrfdX2UY39/wTbATUkNohCycTNOMsfgxk/img.png)

## **열 단위로 처리하는 알고리즘**

![img](https://blog.kakaocdn.net/dn/Qy0bs/btrfbYO2cpe/yhyWqHDPyXJJL8zXtzbTf1/img.png)

![img](https://blog.kakaocdn.net/dn/TqdKM/btrfbBGBhc6/Ygfnsn0Ok8HKJXKZH1VUq1/img.png)