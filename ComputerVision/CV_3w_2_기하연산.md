# CV_3w_2_기하연산

## 기하 연산

일정한 기하 연산으로 결정된 화소의 명암값에 따라 새로운 값을 결정한다.

으악

[참고](https://singularis7.tistory.com/41)



## 영상처리에서의 기하 연산 종류

![image](https://github.com/hhzzzk/studyLog/assets/67236054/69cac645-748e-4eb6-acdf-7f2f1957cd90)



- **Translation** : 픽셀값을 평행 이동 시킨다. 상하좌우 이동
- **Rotation** : 주어진 영상의 픽셀값을 각(세타) 만큼 회전시킨다.
- **Aspect(Scale)** : 확대, 축소시켜준다. 한쪽 방향 혹은 양쪽 방향으로 늘려준다,
- **Affine** : rotation과 translation이 발생한다. 그 때에 x, y축 평행에 대한 정보는 유지된다.
  - *평행선을 유지하면서 변환을 수행함.*
- **Perspective** : 카메라의 원근 투영 효과를 포함해 회전과 이동이 이뤄진다.
  - 원극적 효과를 캡처할 수 있다. 3차원에서 2차원 이미지로의 변환에서 중요하다.
  - *평행선이 유지되지 않는다!*

![image](https://github.com/hhzzzk/studyLog/assets/67236054/8981ab48-ab33-46ed-9ea4-7b64d4e373c5)

###	💙DOF(Degree of Freedom)💙

- 변환에 적용할 수 있는 독립적인 매개 변수의 수를 나타낸다.

---

- 이동은 x축과 y축 방향으로의 변환이므로 DOF가 2이다. 매개변수가 x,y 2개. 각각 x,y이동거리
- rigid : 리지드 변환은 모양은 유지하면서 이동과 회전만 발생한다. (x,y,Θ(회전방향)) DOF 3
- similarity : 유사성은 이동, 회전, scale 크기 변환이다. DOF 4, (x,y,Θ,s - 크기변환비율 )
- affine : 평행선은 유지하면서 이동, 회전, 크기 변환한다. DOF 6, (x,y,Θ,s,    +    xs,ys,)
- projective : 원근변환은 평행성 유지 안함. 이동, 회전, 크기, 원근을 변환한다.
  - x,y,Θ,xs,ys,s + x원근, y원근





## Scaling

좌표를 확대/축소하는 것은 해당 좌표의 각 구성요소를 스칼라로 곱하는 것이다.

**Uniform scaling** : 모든 좌표 구성에 동일한 비율로 크기 조절이 적용된다. x,y 방향이 같은 비율로 변화

**Non-uniform scaling** : x,y중 한 쪽 방향으로만 스케일이 변환된다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/6c0c6e96-9755-4202-b8c9-42bee26ee637)

a,b가 같으면 유니폼 스케일링이고 아니면 논유니폼 스케일링이다.



## Rotation

![image](https://github.com/hhzzzk/studyLog/assets/67236054/5ad073da-1b84-4595-ada3-7507aba6411a)

x,y 픽셀에 대해 세타만큼 변활할 때 위와 같은 관계식을 만족한다.

---

![image](https://github.com/hhzzzk/studyLog/assets/67236054/14657395-5f03-489a-90ed-1a7c055d01fd)

---

x,y 위치에서 세타만큼 움직일 때 위치를 표현하는 방정식이다.

- 주어진 변환에서 sin(Θ)와 cos(Θ)는 Θ에 대한 비선형 함수이다. 그러나 변환된 좌표 x', y'는 x,y의 선형 조합으로 표현된다.
  - 즉 x'와 y'는 x와 y를 선형적으로 조합해 생긴 선형 좌표이다.
  - 회전 변환은 각도 세타에 따라 입력 좌표를 회전시킨다. 이 과정에서 입력과 출력간의 관계는 선형적으로 유지된다. 따라서 결과는 입력의 선형 조합이다. 원래 좌표의 비선형 함수를 사용하지만 새로운 선형 좌표 공간으로 매핑된다.

**💙역변환**💙

 - 회전 변환의 경우 반대방향으로 회전시키는 것이다. 따라서 - Θ 회전이 된다.
 - 회전 변환 행렬은 직교 행렬인 성질에 따라 회전변환 행렬의 역행렬은 기존 행렬의 전치행렬과 같다.



## 다른 변환 행렬

![image](https://github.com/hhzzzk/studyLog/assets/67236054/9b73094f-4e7c-4a11-9eea-b923429b4c03)

---

`아핀 변환은 scale, shear, rotate, translate의 네 가지 기본 변환의 조합으로 이루어진 선형 변환이다.`

**scale**

x' = sx * x
y' = sy * y

**shear**

X' = x + shx * y
Y' = y + shy * x

- 전단 변환은 원래 좌표의 한 축을 다른 축에 비례해 변형시킨다. x축에 대한 전단 변환은 shx에 따라 y값이 변화한다.

**rotate**

x' = x * cos(θ) - y * sin(θ)
y' = x * sin(θ) + y * cos(θ)

**translate**

x' = x + dx
y' = y + dy



## 아핀 변환

`아핀변환은 선형 변환과 이동 변환의 조합으로 이뤄진 변환이다.`

![image](https://github.com/hhzzzk/studyLog/assets/67236054/1b464a23-9136-47f6-a88d-871d502f6ce5)

x' = a*x + b*y + c
y' = d*x + e*y + f

- *a b d e에 대해 선형변환(회전, 스케일)*,	 *c f에 대해 이동변환*


- 직선은 직선으로 변환된다.

- 평행한 직선은 평행을 유지한다.

- 비율이 보존된다. 길이 비율이 변해도 유지된다.

- 여러 개의 아핀 변환을 연속적으로 적용해도 결과는 아핀 변환이 된다.

- 출력에 대해 입력 형태를 유지하기 위해 행렬 하단부에 1 추가함

  - 어파인 변환의 변환 행렬은 보통 3x3 행렬로 표현되며, 

    **마지막 줄에 [0, 0, 1]을 추가하여 평행한 정보를 유지한다.**



## Projective Transformations

- `원근변환은 아핀변환과 Projective warps 원근 왜곡의 조합으로 이뤄진 변환이다.`

![image](https://github.com/hhzzzk/studyLog/assets/67236054/991904d6-e527-499b-8fd8-eda1491ae5a6)



- 직선은 직선으로 변환된다.

- 평행한 직선은 필요에 따라 평행하지 않게 변환될 수 있다.

- 비율이 보존되지 않는다.

- 여러 개의 원근 변환을 해도 결과는 원근 변환이다.

- DOF 8이다.

  - 주어진 이미지에 8개의 좌표 정보가 있다면 해당 이미지에서의 원근 변환 정보를 추정할 수 있다.

- 프로젝티브 변환의 변환 행렬은 보통 3x3 행렬로 표현되며, 마지막 줄에 임의의 값을 추가할 수 있다. 

  이렇게 하면 평행한 정보가 유지되지 않고, 직선들이 변환 후에도 평행하지 않게 된다.





## 동차 좌표와 동차 행렬 homogenous coordinate

[참고](https://n-square.tistory.com/120)

기하 변환은 동차 좌표homogeneous coordinate와 동차 행렬homogeneous matrix로 표현한다.

본래 좌표에 한 차원을 더 추가해서 표현, 1을 추가함

- 동차 좌표에서는 같은 비례 상수를 각각의 좌표 요소에 곱해도 동일한 점을 나타낸다.
- 동차 좌표는 원래 좌표 공간에서 동일한 점을 여러 다른 가중치로 나타낼 수 있는 방법을 제공
  - (3, 5, 1), (6, 10, 2), (0.3, 0.5, 0.1)이 모두 점 (3.5)를 나타낸다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/f0533520-ba8d-4240-ae2f-16abeb3a041f)

### 💙왜 동차 좌표를 사용하나?💙

- 복합 변환을 효율적으로 계산하기 위해서이다.

- 동차 좌표는 기하학적 변환을 표현하고 계산하는데 매우 편리한 방법을 제공한다.

- 동차 좌표를 사용하면 여러 변환을 하나로 합친 복합 변환을 쉽게 계산할 수 있다.

  - 계산 복잡성을 줄이고 성능 향상
  - 예시로 이동과 회전 순차 적용할 때, 일반적으로 두번의 행렬 곱셈이 필요하나 동차 좌표를 사용하면 두 변환을 하나의 변환 행렬로 결합해 한 번의 행렬 곱셈으로 계산할 수 있다.

  ---

![image](https://github.com/hhzzzk/studyLog/assets/67236054/a31c66cd-6b7d-4c96-adee-523351e727a2)

나중에..풀어보기..



## 기하연산 영상에 적용

![image](https://github.com/hhzzzk/studyLog/assets/67236054/354d879d-1ceb-48a2-a12e-b40b5d3b46a4)



**전방 변환**

- 주어진 입력을 새로운 좌표 공간으로 변환하는 과정이다.

- 주의할 점은 이미지를 확대하거나 크기를 조절하는 경우 원래 이미지의 픽셀이 새로운 좌표로 매핑될 때 

  *정보의 손실이 발생할 수 있다.*

- Aliasing : 엘리어싱 현상은 고화질을 낮은 해상도로 샘플링할 때 발생. 정보 손실, 계단 현상 발생

  - 앨리어싱은 비어있는 픽셀이 생긴다는 의미다. 
  - 비어있는 픽셀을 어떻게 처리할 것인가
    - 안티 앨리어싱은 앨리어싱 현상을 줄이기 위한 기술이다.



**후방 변환**

- 엘리어싱 현상을 줄이거나 방지하기 위해 사용된다.
- 새로운 좌표에서 원래 좌표로의 변환을 나타내며 역변환이라고도 한다
- 더 높은 해상도의 이미지를 생성하고 이후 낮은 해상도로 다시 샘플링한다. 이를 통해 고주파 신호의 손실을 줄인다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/250c604d-185b-4483-b041-4d41b19f5ee4)



## 보간interporation에 의한 안티 앨리어싱

![image](https://github.com/hhzzzk/studyLog/assets/67236054/193551e9-4980-470f-9148-54a6ea2f8cc6)

- 실수 좌표를 반올림해 정수로 변환하는 과정에서 앨리어싱 발생, 빈 화소 발생!
  - 보간에 의한 안티 앨리어싱으로 해결
  - 주변값을 활용해 빈 칸을 채워보자

앨리어싱 문제는 주로 실수 좌표를 가진 점을 픽셀 그리드에 매핑할 때 발생한다. 실수 좌표를 가진 점을 가장 가까운 정수 좌표로 반올림하면, 원래 점과 실제 거리가 멀어져 정보 손실이 발생한다. 앨리어싱 발생



### 💙주위 화소 값을 이용한 보간💙

선형 보간은 주변 픽셀의 값을 사용해 실수 좌표에 대한 값을 계산한다. 이를 통해 픽셀 값 사이의 부드러운 변화르 얻을 수 있다.



## 양선형 보간

![image](https://github.com/hhzzzk/studyLog/assets/67236054/17a74855-472a-4c36-b871-ea93682d429e)

주변값들로부터 얼마나 거리 비율을 가졌는지를 통해 명암값을 계산한다.

영상은 2차원 공간이라 x,y축에 대한 비율을 고려해 빈 값을 계산한다.

- 주변 네개의 픽셀 값으로부터 각각에 대한 가중치를 계산, 이를 이용해 보간

+~머라는겨..



## 최근접 이웃, 양선형 보간, 양 3차 보간의 비교

![image](https://github.com/hhzzzk/studyLog/assets/67236054/4fc6d593-2fc0-4970-97bc-cc998692784a)

최근접 이웃 보간은 주어진 입력에서 가장 가까운 값을 사용한다. 계산이 간단하고 빠르나 결과가 부자연스럽고 변화가 급격하다.

양선형 보간은 주변 네개의 포인트를 사용해 입력 위치 주변값을 추정한다. 부드러운 결과를 제공한다.

양3차보간은 주변 16개의 포인트를 사용해 입력 위치 주변값을 추정한다. 매우 부드럽고 고해상도 이미지에 적합하다. 그러나 연산량이 크고 메모리를 많이 사용한다.



## 다해상도

- 해상도를 줄이거나 늘리는 연산이다. 예시로 고해상도 이미지를 휴대전화 해상도에 맞게 줄일 수 있다.
  - 영상의 크기를 변환시키는 것은 픽셀의 수를 변환하는 것이다.

**업샘플링** : 해상도를 정수배 늘린다.

**다운샘플링** : 해상도를 1보다 작게 곱해 해상도를 줄인다.



### 🌳피라미드🌳

피라미드는 이미지에 대해 0.5배씩 다운샘플링해 만든 다양한 해상도 이미지 셋을 말한다. 

---

![image](https://github.com/hhzzzk/studyLog/assets/67236054/5d86a7aa-3c55-41b8-9706-56637cafa438)

해상도를 줄이면 앨리어싱 현상이 발생한다.

이를 해결하는 방법에는 2가지가 있다.

1. 왼쪽 좌표를 사용해 줄이는 방법
2. Burt&Adelson 방법
   - ​