# CV_SIFT_1

4장 지역특징 검출

## 스케일에 불변한 특징점 검출

- 거리에 따른 스케일 변화
  - 기존에는 코너처럼 보이지만 영상을 확대하면 엣지나 플랫처럼 보일 수 있다.
    - 이런 특징은 스케일에 강인하지 않은! 불변하지 않는 특징점이다.
    - 스케일에 강인한, 불변하는 특징점을 찾고 싶다.
  - 이전에 배운 해리스 코너 알고리즘은 조명, 스케일에 강인하지 못한 한계가 있다.
    - 회전, affine 변환에는 불변함.


![img](https://blog.kakaocdn.net/dn/ZKuYU/btrn1ZKHCb8/ZdHUG4tfo56GgAm4OKcS8K/img.png)



## Types of invariance

**invaiance** : 특정한 변화나 조건에 대해 불변하는 성질이다. 불변성

![image](https://github.com/hhzzzk/studyLog/assets/67236054/9b559164-6191-49fe-9c39-aa9ee519a381)

해리스 코너 감지 알고리즘이 각 유형에 어떠한가

**Illumination(조명)** : 강한 조명일 경우 코너 감지에 취약하다.

**Scale** : 크기 변화에 매우 민감하다!

**Rotation** : 회전에는 강인하다.

**Affine** : 아핀 변형은 이미지에서 평행성이 유지되지 않는 변형이다. 강인하다.

> 해리스 코너 디텍션은 이동과 회전에는 강인한 특징을 가지고 있지만 스케일,조명에 대해서는 민감한 단점이 있다.

## SIFT

![image](https://github.com/hhzzzk/studyLog/assets/67236054/ca11c557-df52-4013-bbcd-84b32ee7a10e)



시프트의 등장!

Scale invatiant feature transform 스케일에 불변하는 특징!

스케일의 변화에 강인한 특징을 가진 SIFT 알고리즘이 제안된다.



## SIFT MATCHING

파노라마 영상을 만들기 위해서는 이미지 매칭이 필요하다. 두 개의 영상에서 특징점을 찾아 매칭한다.

🐤**파노라마 이미지 만드는 과정**🐤

1. **특징점 검출** : 두 이미지 간에 공통된 부분을 찾고 해당되는 부분의 특징점들을 찾는다.
   - 이 특징점들을 하나의 기술자 디스크립터로 표현한다. 이는 일반적으로 고차원 벡터로 표현된다. 아래 추가
2. 생성된 고차원 벡터들 간의 유사도를 비교해 두 이미지가 일치하는 부분을 찾는다.
   - **corresponding pairs** 찾기, affine 또는 perspective 변환에 따라 매칭점의 수가 최소 6개나 8개 필요하다. 6-8개의 점을 찾으면 어떤 변환이 이루어졌는지 알 수 있다.
3. **영상 align** : 매칭된 점을 기반으로 두 영상의 회전과 이동을 계산한다. (R,T,S) 두번째 영상을 첫번째 영상과 일치하도록 조정한다.
4. 영상 병합 : 두 영상을 연결해 파노라마 이미지를 만든다. 명암 조절 등

![image](https://github.com/hhzzzk/studyLog/assets/67236054/8380125e-82b1-49e4-b9a7-c37f9b510729)

## 특징점 매칭하기

문제1 : 각 영상으로부터 **똑같은 특징점** 찾아야 한다.

​		같아도 R,T,S하면 인식 못할 수 있다.

​		회전의 이동에, 스케일의 변화에, 조명 환경의 변화에 강인한 특징을 찾아야 된다!

​		어떤 환경에서도 동일하게 찾을 수 있는 특징점 찾기.

문제2 : 똑같은 특징점들을 비교해 **어떻게**  매칭할 것인가?

​		특징점 주변의 디스크립터를 사용하여 각 특징점의 유사도를 계산



🔥**디스크립터**🔥

특징을 잘 기술하는 기술자. 스스로의 특징 잘 나타내고, 주변 특징들과 구분도 잘되게...





## 스케일 공간

스케일에 강인한! 특징을 찾기 위해서는 다양한 해상도의 영상을 사용할 수 있다. 

이를 위해 SIFT 알고리즘은 스케일 공간을 만든다.

다양한 해상도의 영상을 사용해 특징이 유지된다면 스케일의 변화에 강인한 특징점을 찾을 수 있다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/ad71ece6-2d72-4d39-a220-2c2435dfeefa)

- 가우시안 필터와 피라미드 영상을 동시에 사용해 특징을 검출한다.

1. 피라미드 이미지
   - width, height를 1/2씩 줄여가면서 해상도를 다르게 이미지들
2. 가우시안 스무딩
   - 시그마 값에 따라 이미지가 흐려지는 여러 장의 이미지들.

- SIFT의 단점이 여기서 나온다. 영상들을 많이 가지고 있어야 하므로 영상/이미지 숫자와 시간이 비례한다.
- 가우시안 이미지가 4장이면 피라미드도 각 이미지당 4장한다고 하면 16장이 벌써 필요하네 ㄷㄷ

## 가우시안 스무딩에 의한 스케일 공간

각 영상으로부터 시그마 값을 달리해서 가오시안 필터 돌려서 4장의 영상을 본다. 왜 볼까?

local max, min 값을 차기 위한 과정이다!

가우시안 시그마 값은 가우시안 필터 크기와 비례한다. 33, 55, 77 이런 식으로 필터가 커지면서 영상이 스무스해진다.

이 4개의 시그마 값으로 로컬 미니엄, 맥시멈을 찾는 과정



그림상 y축, 세로축이 스케일의 변화에 대한 축이다. 대충 + 방향으로 갈수록 해상도 작아진다 하면

이를 통해 각 피라미드 영상에 대해서도 시그마 값에 따른 값들을 가질 수 있다.

- 스케일 축을 추가한 3차원 공간

![image](https://github.com/hhzzzk/studyLog/assets/67236054/ad89677f-c913-4668-aa5c-5a3f57fb8727)



- t는 스케일 값이다. 해당 3차원 공간은 가우시안 스무딩에 의해 다양한 스케일에서 이미지를 표현한다.





## DoG (Difference of Gaussians)

DoG(Difference of Gaussians) 필터는 가우시안 필터의 차이들을 구한다.

그럼 첫번째 스케일에 대해서도 시그마 값에 따라 영상4-3, 3-2,2-1 이런 식으로 가우시안 필터 씌운 영상들의 차이를 구할 수 있다. 스케일을 따라가면 반복할 수 있다.



`시프트 알고리즘은 주어진 영상에서 local min과 local max가 스케일 변화가 있는 축에 따라 일정하게 유지되는 경우에만 특징점으로 간주한다.`

즉 스케일을 따라 DoG값이 일정하면 스케일에 불변한 특징점이다.



그림에서 5(n)개의 가우시안 씌운 영상이 있으면

각 차이를 구하면 4(n-1)개의 영상이 결과로 나온다. 

![image](https://github.com/hhzzzk/studyLog/assets/67236054/9d392117-e103-40cb-98a2-03d996df12a8)

## 스케일 공간 지역 극점 탐색

t축으로 DoG 영상들의 조합으로부터 극점, 로컬 미니멈과 로컬 맥시멈이 있는지를 찾는다.

각 스케일에서 DoG 영상들을 보고 거기서 로컬 미니멈과 맥시멈을 찾고 스케일 변화 축에 따라서 해당 극점이 유지되고 있으면 시프트의 특징 검출!!!!

???로칼 미니멈과 로칼 맥시멈이 어떻게 있는지는 앞장에서 배웠던 해리스 라플라시안 전략을 이용해서 거기에 대해서 로컬 미니멈과 로컬 맥시멈을 찾는 과정을 거쳤습니다. ???

![image](https://github.com/hhzzzk/studyLog/assets/67236054/932cfa28-d414-4c58-8fdf-a867b22aa0c1)



**t축에서 지역 극점 탐색**

- t축은 스케일을 나타내며 이미지의 다양한 스케일에서 정규 라플라시안을 측정하면 극점이 발생한다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/0ee11fae-385f-4e11-beba-4bae8cf171aa)



- t축에서 정규 라플라시안은 다양한 스케일에서 안정적으로 극점을 생성한다.
- 극점의 σ 값은 물체의 스케일에 해당한다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/86bbbbe4-f44f-44eb-ac99-c8a10dedba43)



![image](https://github.com/hhzzzk/studyLog/assets/67236054/39403f84-8263-476e-ac17-c8879697b0a5)

최대 edge는 0.9정도, 서로 다른 스케일 값에서 최대값 2개가 검출

정규 라플라시안 y값 자체는 비슷하다.



## SIFT 검출

- SIFT의 스케일 공간
  - 피라미드 + 가우시안 구조로 구성된다.
  - 각 층은 여섯 영상의 묶음(옥타브)으로 구성된다. 각 옥타브는 같은 스케일이다.
  - 옥타브의 각 영상은 시그마 값에 따라 스무딩된다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/f57f560c-7014-4de9-9fc9-08071e66e9c8)



## 정규 라플라시안 맵 구축

실혐 결과에 따르면 정규 라플라시안이 가장 안정적으로 극점을 형성한다고 확인됐다.

​		극점은 주요한 특징을 나타낸다.

그러나 정규 라플라시안을 직접 계산하는 것은 비용이 많이 들기에

정규 라플라시안과 유사한 DoG 계산으로 대체된다.

DoG는 차영상을 계산하는 단순한 연산으로 빠르게 수행이 가능하다.

- 정규 라플라시안은 2차 미분한 것이고 도그는 시그마 값이 하나 큰 필터에서 작은 거 뺀다.

![image](https://github.com/hhzzzk/studyLog/assets/67236054/99fbfcf9-451d-453c-9c9d-e142367b86b5)



## 특징점(키 포인트) 검출

- 한 옥타브에 다섯 장의 DOG 영상이 있다.
- 중간에 끼인 3장의 DOG 맵에서 극점이 검출됐다.
  - 주위 26개의 이웃에 대해 최저 또는 최대인 점 (9*3에서 가운데 1개 빼서 26개 이웃)
- 검출된 극점을 키포인트라고 한다. 특징점

DoG 영상을 3개씩 같이 봐야 한다.



![image](https://github.com/hhzzzk/studyLog/assets/67236054/4830b3ef-6dfa-46a0-8be1-416cfe2c3966)

그러나 키포인트를 찾았어도 각 옥타브에서 동일하게 유지되고 있는지 확인해야 한다. 그래야 특징점이다.

만약 스케일 변화를 통해 1,2,3,,,옥타브로 가면서도 키포인트가 유지되고 있다면 스케일에 불변한 특징점이다.



---

![img](https://velog.velcdn.com/images/3eung_h10n/post/255a62e4-a58b-4b38-bcf2-1a0fb3d5f36b/image.png)

